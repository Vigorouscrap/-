<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>âœ¨ å®šåˆ¶ä½ çš„ç¥ç¦ âœ¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Quicksand', 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(145deg, #ffd9e2 0%, #ffb5c0 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.6s;
        }
        /* ----- åˆå§‹é…ç½®é¢æ¿ ----- */
        .config-panel {
            background: rgba(255, 245, 240, 0.9);
            backdrop-filter: blur(12px);
            border-radius: 60px 60px 40px 40px;
            padding: 2.8rem 2.5rem;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 35px 60px rgba(255, 140, 170, 0.35),
                        0 0 0 2px #fff8 inset,
                        0 0 0 5px rgba(255, 255, 255, 0.3) inset;
            border: 3px solid white;
            text-align: center;
            transition: 0.3s;
            animation: panelPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes panelPop {
            0% { opacity: 0; transform: scale(0.7); }
            100% { opacity: 1; transform: scale(1); }
        }
        .config-panel h1 {
            font-size: 2.7rem;
            font-weight: 600;
            color: #9f4d5f;
            text-shadow: 0 4px 10px #ffb8c9;
            letter-spacing: 2px;
            margin-bottom: 1.2rem;
            word-break: break-word;
        }
        .config-panel h1 span {
            display: inline-block;
            font-size: 2.9rem;
            margin-left: 6px;
            filter: drop-shadow(0 4px 6px #ff9eb5);
        }
        .input-group {
            margin: 30px 0 25px;
            text-align: left;
        }
        .input-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 500;
            color: #7a4b55;
            margin-bottom: 10px;
            padding-left: 8px;
            letter-spacing: 0.5px;
        }
        .input-group label span {
            font-size: 2rem;
        }
        .input-group input {
            width: 100%;
            padding: 18px 28px;
            font-size: 1.5rem;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.7);
            border: 3px solid white;
            border-radius: 70px;
            outline: none;
            color: #4e2f36;
            font-weight: 500;
            transition: 0.2s;
            box-shadow: 0 8px 18px #ffb8c9;
        }
        .input-group input:focus {
            border-color: #ff8da1;
            background: #fff0f2;
            box-shadow: 0 8px 25px #ff98af;
        }
        .input-group input::placeholder {
            color: #dba1ae;
            font-size: 1.2rem;
            font-weight: 300;
            opacity: 0.8;
        }
        .hint-emoji {
            margin: 15px 0 10px;
            color: #ad6577;
            font-size: 1.3rem;
            background: #ffeef1;
            padding: 14px 10px;
            border-radius: 50px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px 18px;
            border: 2px dashed #ffb0bd;
        }
        .hint-emoji span {
            font-size: 2.2rem;
            cursor: pointer;
            transition: 0.2s;
            filter: drop-shadow(0 2px 4px #f79cac);
        }
        .hint-emoji span:hover {
            transform: scale(1.4);
        }
        .btn-create {
            background: #ffb6c7;
            border: none;
            color: #4d2f38;
            font-size: 2rem;
            font-weight: 600;
            padding: 20px 25px;
            border-radius: 120px;
            width: 100%;
            margin-top: 25px;
            box-shadow: 0 12px 0 #a7536b, 0 10px 35px #ff8da1;
            cursor: pointer;
            transition: 0.07s linear;
            border: 3px solid #fff9fc;
            letter-spacing: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .btn-create:active {
            transform: translateY(7px);
            box-shadow: 0 5px 0 #a7536b, 0 15px 35px #ff8da1;
        }
        /* ----- ç¥ç¦é¡µ (åˆå§‹éšè—) ----- */
        .magic-stage {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.8s;
            pointer-events: none;
        }
        .magic-stage.show {
            opacity: 1;
            pointer-events: auto;
        }
        /* å…¶ä½™æ ·å¼ä¸åŸæ¥ä¸€è‡´ */
        .heart-box {
            position: relative;
            z-index: 50;
            animation: lovely-beat 1.3s infinite cubic-bezier(0.5, 0.1, 0.3, 1.5);
            transform-origin: center;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .real-heart { width: 240px; height: 240px; }
        .real-heart svg { width: 100%; height: 100%; filter: drop-shadow(0 15px 25px rgba(255, 170, 180, 0.35)); will-change: filter; }
        @keyframes lovely-beat {
            0% { transform: scale(1); } 15% { transform: scale(1.12); } 28% { transform: scale(1.2); } 40% { transform: scale(1.08); } 55% { transform: scale(1); } 70% { transform: scale(0.98); } 85% { transform: scale(1.03); } 100% { transform: scale(1); }
        }
        .scattered-stars {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 20;
        }
        .star, .custom-emoji {
            position: absolute; white-space: nowrap; animation: float-shine 4s infinite alternate ease-in-out; filter: drop-shadow(0 0 8px rgba(255, 194, 179, 0.5)); opacity: 0.9; -webkit-transform: translateZ(0); transform: translateZ(0);
        }
        .star { color: rgba(255, 255, 255, 0.98); font-size: 26px; text-shadow: 0 0 20px #ffcfb0, 0 0 45px #ffb7b7; }
        .custom-emoji { font-size: 32px; text-shadow: 0 0 30px #b0d6ff, 0 0 60px #ffb7c5; }
        .star-small { font-size: 18px; } .star-large { font-size: 34px; }
        .emoji-small { font-size: 24px; } .emoji-large { font-size: 44px; }
        @keyframes float-shine {
            0% { transform: translateY(0px) scale(0.95); opacity: 0.6; }
            100% { transform: translateY(-20px) scale(1.2); opacity: 1; }
        }
        .danmaku-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 15; overflow: hidden; }
        .danmaku {
            position: absolute; white-space: nowrap; color: rgba(255, 255, 255, 0.95); font-size: 22px; font-weight: 400; letter-spacing: 2px; text-shadow: 0 0 12px rgba(255, 150, 150, 0.6); background: rgba(255, 235, 230, 0.2); padding: 6px 18px; border-radius: 50px; backdrop-filter: blur(4px); border: 1px solid rgba(255, 255, 255, 0.25); animation: scrollDanmaku linear infinite; z-index: 15; transform: translateX(100vw); animation-fill-mode: forwards; -webkit-transform: translateX(100vw) translateZ(0); transform: translateX(100vw) translateZ(0); will-change: transform;
        }
        .danmaku.slow { animation-duration: 30s; font-size: 20px; } .danmaku.medium { animation-duration: 22s; font-size: 24px; } .danmaku.fast { animation-duration: 16s; font-size: 18px; } .danmaku.xlarge { font-size: 30px; animation-duration: 38s; }
        @keyframes scrollDanmaku {
            0% { transform: translateX(100vw) translateZ(0); opacity: 0.4; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateX(-450px) translateZ(0); opacity: 0; }
        }
        #fireworks-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .signature { position: absolute; bottom: 20px; right: 30px; color: #ffffff; font-size: 15px; background: rgba(255, 200, 200, 0.25); padding: 6px 20px; border-radius: 40px; backdrop-filter: blur(4px); z-index: 60; pointer-events: none; border: 1px solid rgba(255, 255, 255, 0.3); letter-spacing: 2px; text-shadow: 0 0 8px rgba(255, 100, 100, 0.4); -webkit-transform: translateZ(0); transform: translateZ(0); }
        .hint-click { position: absolute; bottom: 20px; left: 30px; color: #ffffff; font-size: 15px; background: rgba(255, 200, 200, 0.25); padding: 6px 24px; border-radius: 50px; backdrop-filter: blur(4px); z-index: 60; pointer-events: none; border: 1px solid rgba(255, 255, 255, 0.3); text-shadow: 0 0 8px rgba(255, 100, 100, 0.4); -webkit-transform: translateZ(0); transform: translateZ(0); }
        @media (max-width: 600px) { .real-heart { width: 180px; height: 180px; } .danmaku { font-size: 18px; } }
        .hidden { display: none; }
        .config-panel.fade-out { opacity: 0; transform: scale(0.8); pointer-events: none; transition: 0.4s; }
        
        /* ----- æ–°å¢åˆ†äº«æŒ‰é’®æ ·å¼ ----- */
        .share-box {
            position: fixed;
            bottom: 90px;
            right: 30px;
            background: rgba(255, 220, 230, 0.9);
            backdrop-filter: blur(8px);
            padding: 14px 28px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 200;
            box-shadow: 0 8px 25px rgba(255, 120, 160, 0.5);
            border: 2px solid white;
            font-size: 1.2rem;
            font-weight: 600;
            color: #6b3a48;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.2s;
        }
        .share-box:hover {
            transform: scale(1.05);
            background: rgba(255, 200, 220, 0.95);
        }
        .share-url-container {
            position: fixed;
            bottom: 160px;
            right: 30px;
            left: 30px;
            margin: 0 auto;
            max-width: 500px;
            background: white;
            padding: 18px 22px;
            border-radius: 50px;
            box-shadow: 0 15px 40px rgba(255, 100, 130, 0.4);
            z-index: 250;
            display: none;
            border: 3px solid #ffc0cb;
            word-break: break-all;
            font-size: 0.9rem;
            text-align: center;
        }
        .share-url-container.show {
            display: block;
        }
        .close-share {
            position: absolute;
            top: -10px;
            right: 0px;
            background: #ff8da1;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid white;
        }
    </style>
</head>
<body>
    <!-- é…ç½®é¢æ¿ -->
    <div class="config-panel" id="configPanel">
        <h1>ğŸŒ¸ å®šåˆ¶ä½ çš„ç¥ç¦ ğŸŒ¸</h1>
        <div class="input-group">
            <label><span>ğŸ‘¤</span> é€ç»™è°ï¼Ÿ</label>
            <input type="text" id="inputName" placeholder="ä¾‹ï¼šxxx" value="">
        </div>
        <div class="input-group">
            <label><span>ğŸ¨</span> è£…é¥°è¡¨æƒ… (å¯å¤šä¸ª)</label>
            <input type="text" id="inputEmojis" placeholder="ä¾‹ï¼šâ­ğŸŒŸğŸ’™" value="">
        </div>
        <div class="hint-emoji">
            <span>â­</span> <span>ğŸŒŸ</span> <span>âœ¨</span> <span>ğŸ’«</span> <span>ğŸ’™</span> <span>ğŸ’–</span>  <span>ğŸŒ¸</span> <span>ğŸŒˆ</span> <span>ğŸ°</span>
        </div>
        <button class="btn-create" id="createBtn">âœ¨ ç¡®å®š âœ¨</button>
        <p style="margin-top: 20px; color:#b27c89; font-size:1.2rem;">ç‚¹å‡»ç¡®å®šåï¼ŒèƒŒæ™¯ä¼šå‡ºç°ä½ è¾“å…¥çš„å›¾æ¡ˆ~</p>
    </div>

    <!-- ç¥ç¦èˆå° (åŠ¨æ€ç”Ÿæˆ) -->
    <div class="magic-stage" id="magicStage">
        <div class="heart-box" id="heart">
            <div class="real-heart" style="width:240px; height:240px;">
                <svg viewBox="80 190 500 120" width="240" height="240">
                    <defs>
                        <radialGradient id="heartGradient" cx="35%" cy="30%" r="70%">
                            <stop offset="0%" stop-color="#ffe6ea"/>
                            <stop offset="60%" stop-color="#ffc1c8"/>
                            <stop offset="100%" stop-color="#ff9fad"/>
                        </radialGradient>
                        <radialGradient id="highlight" cx="50%" cy="0%" r="60%">
                            <stop offset="0%" stop-color="rgba(255,255,255,0.7)"/>
                            <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
                        </radialGradient>
                    </defs>
                    <path d="M256 464s-176-104-176-232c0-66 54-120 120-120 44 0 84 24 104 60 20-36 60-60 104-60 66 0 120 54 120 120 0 128-176 232-176 232z" fill="url(#heartGradient)"/>
                    <ellipse cx="260" cy="160" rx="90" ry="60" fill="url(#highlight)" opacity="0.6"/>
                </svg>
            </div>
        </div>
        <div class="scattered-stars" id="dynamicField"></div>
        <div class="danmaku-screen" id="danmakuContainer"></div>
        <canvas id="fireworks-canvas"></canvas>
        <div class="signature" id="signatureText">ğŸ’— åå­—ï¼Œæ°¸è¿œå¹¸ç¦ ğŸ’—</div>
        <div class="hint-click">âœ¨ ç‚¹å‡»çˆ±å¿ƒï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ âœ¨</div>
    </div>

    <!-- æ–°å¢åˆ†äº«æŒ‰é’®å’Œæ˜¾ç¤ºåŒºåŸŸ (åˆå§‹éšè—) -->
    <div class="share-box" id="shareBtn">ğŸ”— ç”Ÿæˆåˆ†äº«é“¾æ¥</div>
    <div class="share-url-container" id="shareUrlContainer">
        <span class="close-share" id="closeShare">Ã—</span>
        <div style="margin-bottom: 8px; font-weight: bold; color:#b2485e;">âœ¨ å¤åˆ¶é“¾æ¥åˆ†äº« âœ¨</div>
        <div id="shareUrlText" style="background:#fff0f5; padding:12px; border-radius:30px; border:1px dashed #ffb6c1;"></div>
        <div style="margin-top: 12px; font-size:0.9rem; color:#a15c6b;">æœ‹å‹æ‰“å¼€é“¾æ¥å°±èƒ½çœ‹åˆ°ä½ çš„å®šåˆ¶ç¥ç¦å•¦</div>
    </div>

    <script>
        (function(){
            // ------ çƒŸèŠ±ç³»ç»Ÿ (ä¿æŒä¸å˜) ------
            const canvas = document.getElementById('fireworks-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            let fireworksActive = false;
            let animFrame = null;

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeCanvas);

            function createFireworkBurst(x, y) {
                const colors = ['#FFDDC4', '#FFE4D6', '#FFD9C0', '#FFC4C0', '#FFB6B9', '#FFE0B2', '#FFD2B0', '#FFEAD2'];
                const count = 65 + Math.floor(Math.random() * 45);
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const speed = 3.5 + Math.random() * 10;
                    const vx = Math.cos(angle) * speed * (0.6 + Math.random() * 0.6);
                    const vy = Math.sin(angle) * speed * (0.6 + Math.random() * 0.6);
                    const size = 6 + Math.random() * 14;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    particles.push({ x, y, vx, vy, size, color, alpha: 0.9, life: 0.95 + Math.random() * 0.2, decay: 0.012 + Math.random() * 0.014 });
                }
                if (!fireworksActive) {
                    fireworksActive = true;
                    animateFireworks();
                }
            }

            function animateFireworks() {
                if (!fireworksActive) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let hasAlive = false;
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx; p.y += p.vy; p.vy += 0.045; p.vx *= 0.992; p.vy *= 0.992; p.life -= p.decay; p.alpha = p.life * 0.8;
                    if (p.life <= 0.02 || p.x < -50 || p.x > canvas.width + 50 || p.y < -50 || p.y > canvas.height + 50) {
                        particles.splice(i, 1); continue;
                    }
                    hasAlive = true;
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.size * p.life * 0.7, 0, Math.PI * 2);
                    ctx.fillStyle = p.color; ctx.shadowColor = '#FFF1E0'; ctx.shadowBlur = 16 * p.life; ctx.globalAlpha = p.alpha * 0.9; ctx.fill();
                    ctx.shadowBlur = 20; ctx.fillStyle = '#FFFEF9'; ctx.globalAlpha = p.alpha * 0.4; ctx.arc(p.x - 1, p.y - 1, p.size * p.life * 0.3, 0, Math.PI * 2); ctx.fill();
                }
                ctx.shadowBlur = 0; ctx.globalAlpha = 1;
                if (hasAlive) { animFrame = requestAnimationFrame(animateFireworks); } 
                else { fireworksActive = false; cancelAnimationFrame(animFrame); animFrame = null; }
            }

            // è·å–å…ƒç´ 
            const configPanel = document.getElementById('configPanel');
            const magicStage = document.getElementById('magicStage');
            const inputName = document.getElementById('inputName');
            const inputEmojis = document.getElementById('inputEmojis');
            const createBtn = document.getElementById('createBtn');
            const dynamicField = document.getElementById('dynamicField');
            const danmakuContainer = document.getElementById('danmakuContainer');
            const signatureSpan = document.getElementById('signatureText');
            const heart = document.getElementById('heart');
            
            // æ–°å¢åˆ†äº«ç›¸å…³å…ƒç´ 
            const shareBtn = document.getElementById('shareBtn');
            const shareContainer = document.getElementById('shareUrlContainer');
            const shareText = document.getElementById('shareUrlText');
            const closeShare = document.getElementById('closeShare');

            // ç‚¹å‡»çˆ±å¿ƒè§¦å‘çƒŸèŠ±
            heart.addEventListener('click', function(e) {
                e.stopPropagation();
                let rect = heart.getBoundingClientRect();
                let x = rect.left + rect.width/2;
                let y = rect.top + rect.height/2;
                if (e.clientX && e.clientY) { x = e.clientX; y = e.clientY; }
                createFireworkBurst(x, y);
                setTimeout(() => createFireworkBurst(x-30, y-20), 100);
                setTimeout(() => createFireworkBurst(x+40, y+10), 200);
                setTimeout(() => createFireworkBurst(x-20, y+40), 300);
                setTimeout(() => createFireworkBurst(x+30, y-30), 400);
            });

            // è¾…åŠ©ï¼šä»å­—ç¬¦ä¸²æå– emoji æ•°ç»„
            function extractEmojis(str) {
                if (!str) return ['ğŸ’™'];
                const trimmed = str.replace(/\s+/g, '');
                if (trimmed.length === 0) return ['ğŸ’™'];
                return Array.from(trimmed);
            }

            // ç”ŸæˆèƒŒæ™¯è£…é¥°
            function generateBackground(name, emojiStr) {
                if (!dynamicField) return;
                dynamicField.innerHTML = '';
                const emojiList = extractEmojis(emojiStr);
                const totalCount = 30;
                const w = window.innerWidth;
                const h = window.innerHeight;
                const centerX = w/2, centerY = h/2 - 10;

                for (let i = 0; i < totalCount; i++) {
                    const el = document.createElement('span');
                    if (i % 2 === 0 && emojiList.length > 0) {
                        const randomEmoji = emojiList[Math.floor(Math.random() * emojiList.length)];
                        el.className = 'custom-emoji';
                        el.innerHTML = randomEmoji;
                        if (Math.random() < 0.3) el.classList.add('emoji-large');
                        else if (Math.random() < 0.5) el.classList.add('emoji-small');
                    } else {
                        el.className = 'star';
                        const randStar = Math.random();
                        if (randStar < 0.33) el.innerHTML = 'â­';
                        else if (randStar < 0.66) el.innerHTML = 'âœ¨';
                        else el.innerHTML = 'ğŸŒŸ';
                        if (Math.random() < 0.3) el.classList.add('star-large');
                        else if (Math.random() < 0.5) el.classList.add('star-small');
                    }

                    let x, y;
                    do {
                        x = Math.random() * w;
                        y = Math.random() * h;
                    } while (Math.abs(x - centerX) < 170 && Math.abs(y - centerY) < 160);

                    el.style.left = x + 'px';
                    el.style.top = y + 'px';
                    el.style.animationDelay = (Math.random() * 6) + 's';
                    el.style.animationDuration = (3 + Math.random() * 5) + 's';
                    el.style.transform = `rotate(${Math.random() * 30}deg)`;
                    dynamicField.appendChild(el);
                }
            }

            // ç”Ÿæˆå¼¹å¹•
            function generateDanmaku(name) {
                if (!danmakuContainer) return;
                danmakuContainer.innerHTML = '';
                const safeName = name.trim() || 'å®è´';
                const messages = [
                    `${safeName}ï¼Œæˆ‘çˆ±ä½  ğŸ’•`, `${safeName}ï¼Œå¸Œæœ›ä½ ä¸€è¾ˆå­å¹¸ç¦ ğŸŒ¹`,
                    `${safeName}ï¼Œä½ æ˜¯æœ€æ¸©æŸ”çš„æ˜Ÿå…‰ âœ¨`, `${safeName}ï¼Œæ¯å¤©éƒ½è¦å¼€å¿ƒå‘€ ğŸ°`,
                    `${safeName}ï¼Œé‡è§ä½ æ˜¯å¥‡è¿¹ ğŸ€`, `${safeName}ï¼Œæˆ‘çš„å¥¶æ²¹å°å¯çˆ± ğŸ¦`,
                    `${safeName}ï¼Œæƒ³å’Œä½ ä¸€èµ·çœ‹æ˜Ÿæ˜Ÿ ğŸŒ `, `${safeName}ï¼Œæ°¸è¿œåšä½ çš„åç›¾ ğŸ›¡ï¸`,
                    `${safeName}ï¼Œè¿™ä¸–ç•Œå› ä½ è€Œç”œ ğŸ¬`, `${safeName}ï¼Œä½ çš„ç¬‘å®¹åƒæ˜¥é£ ğŸŒ¸`,
                    `${safeName}ï¼Œé™ªä½ èµ°è¿‡æ¯ä¸ªå››å­£ ğŸ‚`, `${safeName}ï¼Œä½ æ˜¯å¿ƒä¹‹æ‰€å‘ ğŸ’˜`,
                    `${safeName}ï¼Œè¦ä¸€ç›´å¹¸ç¦ä¸‹å» ğŸ•Šï¸`, `${safeName}ï¼Œæˆ‘æœ€å–œæ¬¢ä½ äº† ğŸ’—`,
                    `${safeName}ï¼Œæ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾… ğŸŒ`, `${safeName}ï¼Œä½ æ¯”å¥¶æ²¹æ›´ç”œç¾ ğŸ§`,
                    `${safeName}ï¼Œä»Šå¤©ä¹Ÿå¾ˆæƒ³ä½  ğŸ’­`, `${safeName}ï¼Œæˆ‘ä»¬æ°¸è¿œåœ¨ä¸€èµ· ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©`,
                    `${safeName}ï¼Œæ™šå®‰å’Œæ—©å®‰ ğŸŒ™â˜€ï¸`, `${safeName}ï¼Œè°¢è°¢ä½ æ¥åˆ°æˆ‘èº«è¾¹ ğŸ`,
                    `${safeName}ï¼Œçˆ±ä½ ä¸æ˜¯ä¸¤ä¸‰å¤© ğŸ’`, `${safeName}ï¼Œæƒ³å’Œä½ ç¯æ¸¸ä¸–ç•Œ âœˆï¸`,
                    `${safeName}ï¼Œä½ è®©å¹³å‡¡å‘å…‰ âœ¨`, `${safeName}ï¼Œä¸€è¾ˆå­å®ˆæŠ¤ä½  ğŸ•¯ï¸`,
                    `${safeName}ï¼Œåšä½ æ°¸è¿œçš„æ˜Ÿæ˜Ÿ â­`, `${safeName}ï¼Œæ‰€æœ‰ç¾å¥½éƒ½ç»™ä½  ğŸ`,
                    `${safeName}ï¼Œå¿ƒè·³éƒ½æ˜¯ä½  ğŸ’“`, `${safeName}ï¼Œæœ€å¥½çš„ç¥ç¦ç»™ä½  ğŸ‰`
                ];
                const count = 22;
                const segmentHeight = 100 / count;
                for (let i = 0; i < count; i++) {
                    const dan = document.createElement('div');
                    dan.className = 'danmaku';
                    dan.textContent = messages[Math.floor(Math.random() * messages.length)];
                    const r = Math.random();
                    if (r < 0.33) dan.classList.add('slow');
                    else if (r < 0.66) dan.classList.add('medium');
                    else dan.classList.add('fast');
                    if (Math.random() > 0.7) dan.classList.add('xlarge');

                    const basePos = i * segmentHeight + segmentHeight/2;
                    const offset = (Math.random() - 0.5) * segmentHeight * 0.3;
                    let topPos = basePos + offset;
                    topPos = Math.min(95, Math.max(5, topPos));
                    dan.style.top = topPos + '%';
                    dan.style.animationDelay = (Math.random() * 5) + 's';
                    dan.style.color = `rgba(255,255,255,${0.92+Math.random()*0.08})`;
                    dan.style.background = `rgba(255,235,230,${0.1+Math.random()*0.1})`;
                    danmakuContainer.appendChild(dan);
                }
            }

            // ç”Ÿæˆç¥ç¦é¡µé¢çš„æ ¸å¿ƒå‡½æ•° (ä»å‚æ•°è¯»å–æˆ–ä»è¾“å…¥æ¡†)
            function generateEverything(nameFromParam, emojisFromParam) {
                // å¦‚æœä¼ å…¥äº†å‚æ•°åˆ™ä½¿ç”¨å‚æ•°ï¼Œå¦åˆ™ä½¿ç”¨è¾“å…¥æ¡†
                const name = nameFromParam !== undefined ? nameFromParam : (inputName.value.trim() || 'è€å·±');
                const emojis = emojisFromParam !== undefined ? emojisFromParam : (inputEmojis.value.trim() || 'â­ğŸ’™');
                
                // æ›´æ–°è¾“å…¥æ¡†çš„å€¼ï¼ˆä»¥ä¾¿åç»­åˆ†äº«ä½¿ç”¨æ­£ç¡®å€¼ï¼‰
                inputName.value = name;
                inputEmojis.value = emojis;
                
                // æ›´æ–°è½æ¬¾
                signatureSpan.innerText = `ğŸ’— ${name}ï¼Œæ°¸è¿œå¹¸ç¦ ğŸ’—`;
                // ç”ŸæˆèƒŒæ™¯å’Œå¼¹å¹•
                generateBackground(name, emojis);
                generateDanmaku(name);
                // åˆ‡æ¢æ˜¾ç¤º
                configPanel.classList.add('fade-out');
                setTimeout(() => {
                    configPanel.style.display = 'none';
                    magicStage.classList.add('show');
                    resizeCanvas();
                }, 300);
            }

            // ä»URLå‚æ•°åŠ è½½
            function loadFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                const nameParam = urlParams.get('name');
                const emojisParam = urlParams.get('emojis');
                
                if (nameParam || emojisParam) {
                    // è§£ç å‚æ•°
                    const name = nameParam ? decodeURIComponent(nameParam) : 'è€å·±';
                    const emojis = emojisParam ? decodeURIComponent(emojisParam) : 'â­ğŸ’™';
                    
                    // ç›´æ¥ç”Ÿæˆç¥ç¦é¡µé¢ï¼Œä¸æ˜¾ç¤ºé…ç½®é¢æ¿
                    generateEverything(name, emojis);
                }
            }

            // åˆ›å»ºåˆ†äº«URL
            function createShareUrl() {
                const name = encodeURIComponent(inputName.value.trim() || 'è€å·±');
                const emojis = encodeURIComponent(inputEmojis.value.trim() || 'â­ğŸ’™');
                const baseUrl = window.location.href.split('?')[0]; // å»æ‰ç°æœ‰å‚æ•°
                return `${baseUrl}?name=${name}&emojis=${emojis}`;
            }

            // æ˜¾ç¤ºåˆ†äº«é“¾æ¥
            function showShareUrl() {
                const url = createShareUrl();
                shareText.innerText = url;
                shareContainer.classList.add('show');
                
                // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(url).then(() => {
                    // å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªçŸ­æš‚çš„æç¤ºï¼Œä½†ä¸ºäº†ç®€æ´ï¼Œæˆ‘ä»¬ç›´æ¥è®©é“¾æ¥æ˜¾ç¤º
                }).catch(() => {
                    // é™çº§ï¼šæç¤ºæ‰‹åŠ¨å¤åˆ¶
                });
            }

            // ç»‘å®šåˆ†äº«æŒ‰é’®äº‹ä»¶
            shareBtn.addEventListener('click', showShareUrl);
            
            // å…³é—­åˆ†äº«å¼¹çª—
            closeShare.addEventListener('click', () => {
                shareContainer.classList.remove('show');
            });

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥å…³é—­ï¼ˆå¯é€‰ï¼‰
            window.addEventListener('click', (e) => {
                if (!shareContainer.contains(e.target) && e.target !== shareBtn) {
                    shareContainer.classList.remove('show');
                }
            });

            // åŸæœ‰ç”Ÿæˆé€»è¾‘ (ç‚¹å‡»ç¡®å®šæŒ‰é’®)
            createBtn.addEventListener('click', () => {
                generateEverything();
            });

            // ç‚¹å‡»æç¤ºemojiå¿«é€Ÿå¡«å…¥
            document.querySelectorAll('.hint-emoji span').forEach(span => {
                span.addEventListener('click', function() {
                    const current = inputEmojis.value;
                    inputEmojis.value = current + this.innerText;
                });
            });

            // å…è®¸å›è½¦è§¦å‘
            inputEmojis.addEventListener('keypress', (e) => { if (e.key === 'Enter') generateEverything(); });
            inputName.addEventListener('keypress', (e) => { if (e.key === 'Enter') generateEverything(); });

            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥URLå‚æ•°
            window.addEventListener('load', () => {
                loadFromUrl();
            });

            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°å¸ƒå±€èƒŒæ™¯ï¼ˆä»…å½“èˆå°æ˜¾ç¤ºæ—¶ï¼‰
            window.addEventListener('resize', () => {
                if (magicStage.classList.contains('show')) {
                    const name = inputName.value.trim() || 'è€å·±';
                    const emojis = inputEmojis.value.trim() || 'â­ğŸ’™';
                    generateBackground(name, emojis);
                }
            });
        })();
    </script>
</body>
</html>